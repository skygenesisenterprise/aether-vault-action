events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;
    
    # Logging
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';
    
    access_log /var/log/nginx/access.log main;
    error_log /var/log/nginx/error.log warn;
    
    # Mock Vault endpoints
    server {
        listen 8200;
        server_name localhost;
        
        # Health check endpoint
        location /v1/sys/health {
            add_header Content-Type application/json;
            return 200 '{
                "initialized": true,
                "sealed": false,
                "standby": false,
                "performance_standby": false,
                "replication_performance_mode": "unknown",
                "replication_dr_mode": "unknown",
                "server_configured": true,
                "version": "1.15.0",
                "cluster_name": "aether-vault-demo",
                "cluster_id": "demo-cluster-id"
            }';
        }
        
        # GitHub OIDC login endpoint
        location /v1/auth/github/login {
            add_header Content-Type application/json;
            
            # Mock response for successful authentication
            return 200 '{
                "auth": {
                    "client_token": "mock-vault-token-12345",
                    "accessor": "mock-accessor-67890",
                    "policies": ["default", "demo-role"],
                    "token_policies": ["default", "demo-role"],
                    "metadata": {
                        "role": "demo-role",
                        "repository": "skygenesisenterprise/aether-vault"
                    },
                    "lease_duration": 3600,
                    "renewable": true,
                    "entity_id": "demo-entity-id",
                    "token_type": "service"
                },
                "warnings": null,
                "wrap_info": null,
                "data": null,
                "lease_duration": 0,
                "renewable": false,
                    "request_id": "demo-request-id"
            }';
        }
        
        # Policy check endpoint
        location /v1/policies/check {
            add_header Content-Type application/json;
            
            # Mock response for successful policy check
            return 200 '{
                "status": "success",
                "report_id": "demo-report-id-12345",
                "violations": [],
                "policy_results": {
                    "security": "pass",
                    "compliance": "pass",
                    "access": "pass"
                },
                "timestamp": "2025-01-06T10:00:00Z",
                "metadata": {
                    "role": "demo-role",
                    "policy_mode": "enforce"
                }
            }';
        }
        
        # Mock violation endpoint (for testing)
        location /v1/policies/check/violation {
            add_header Content-Type application/json;
            
            # Mock response for policy violation
            return 200 '{
                "status": "violation",
                "report_id": "violation-report-id-67890",
                "violations": [
                    {
                        "rule": "security-policy-001",
                        "severity": "high",
                        "description": "Potential security vulnerability detected",
                        "details": "Mock violation for testing purposes"
                    }
                ],
                "policy_results": {
                    "security": "fail",
                    "compliance": "pass",
                    "access": "pass"
                },
                "timestamp": "2025-01-06T10:00:00Z",
                "metadata": {
                    "role": "demo-role",
                    "policy_mode": "enforce"
                }
            }';
        }
        
        # Default response for other endpoints
        location / {
            add_header Content-Type application/json;
            return 404 '{
                "errors": ["unsupported path"],
                "request_id": "demo-request-id"
            }';
        }
    }
}